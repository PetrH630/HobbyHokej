

===== FILE: \MatchActions.jsx =====

// src/components/MatchActions.jsx
import "./MatchActions.css";

const MatchActions = ({
    playerMatchStatus,
    onRegister,
    onUnregister,
    onExcuse,
    disabled,
}) => {
    console.log(
        "MatchActions status:",
        playerMatchStatus,
        "disabled:",
        disabled
    );

    const renderButtons = () => {
        switch (playerMatchStatus) {
            case "NO_RESPONSE":
                // ≈æ√°dn√° registrace ‚Äì Budu / Nemohu (omluva)
                return (
                    <div className="d-flex gap-2 justify-content-center">
                        <button
                            type="button"
                            className="btn btn-success action-btn"
                            onClick={onRegister}
                            disabled={disabled}
                        >
                            Budu
                        </button>

                        <button
                            type="button"
                            className="btn btn-outline-danger action-btn"
                            onClick={onExcuse}
                            disabled={disabled}
                        >
                            Nemohu
                        </button>
                    </div>
                );

            case "REGISTERED":
            case "RESERVED":
                // p≈ôihl√°≈°en nebo n√°hradn√≠k ‚Äì m≈Ø≈æe se jen odhl√°sit
                return (
                    <div className="d-flex justify-content-center">
                        <button
                            type="button"
                            className="btn btn-outline-danger action-btn"
                            onClick={onUnregister}
                            disabled={disabled}
                        >
                            Nakonec nebudu
                        </button>
                    </div>
                );

            case "EXCUSED":
            case "UNREGISTERED":
                // omluven / odhl√°≈°en ‚Äì m≈Ø≈æe se znova p≈ôihl√°sit
                return (
                    <div className="d-flex justify-content-center">
                        <button
                            type="button"
                            className="btn btn-success action-btn"
                            onClick={onRegister}
                            disabled={disabled}
                        >
                            Nakonec budu
                        </button>
                    </div>
                );

            case "NO_EXCUSED":
                // neomluven ‚Äì stav uzav≈ôen
                return null;

            default:
                console.warn(
                    "Nezn√°m√Ω status v MatchActions:",
                    playerMatchStatus
                );
                return null;
        }
    };

    return (
        <div className="d-flex flex-wrap gap-2 justify-content-center mb-4">
            {renderButtons()}
        </div>
    );
};

export default MatchActions;

===== FILE: \MatchCard.jsx =====

// src/components/MatchCard.jsx
import {
    RegisteredIcon,
    UnregisteredIcon,
    ExcusedIcon,
    ReservedIcon,
    NoResponseIcon,
    NoExcusedIcon,
    UserIcon,
    MoneyIcon,
} from "../../icons";

import "./MatchCard.css";

const statusClassMap = {
    REGISTERED: "match-registered",
    UNREGISTERED: "match-unregistered",
    EXCUSED: "match-excused",
    RESERVED: "match-reserved",
    NO_RESPONSE: "match-no-response",
    NO_EXCUSED: "match-no-excused",
};

const statusTextUpcomingMap = {
    REGISTERED: "BUDU",
    UNREGISTERED: "ODHL√Å≈†EN",
    EXCUSED: "NEM≈Æ≈ΩU",
    RESERVED: "ƒåEK√ÅM",
    NO_RESPONSE: "NEV√çM",
    NO_EXCUSED: "NEOMLUVEN",
};

const statusTextPastMap = {
    REGISTERED: "",
    NO_RESPONSE: "NEREAGOVAL",
    NO_EXCUSED: "NEP≈òI≈†EL",
    UNREGISTERED: "ODHL√Å≈†EN",
    EXCUSED: "NEMOHL",
    RESERVED: "ƒåEKAL",
};

const statusIconMap = {
    REGISTERED: RegisteredIcon,
    UNREGISTERED: UnregisteredIcon,
    EXCUSED: ExcusedIcon,
    RESERVED: ReservedIcon,
    NO_RESPONSE: NoResponseIcon,
    NO_EXCUSED: NoExcusedIcon,
};

const formatDateTime = (dateTime) => {
    if (!dateTime) return null;

    const iso = dateTime.replace(" ", "T");
    const d = new Date(iso);

    const dayName = new Intl.DateTimeFormat("cs-CZ", {
        weekday: "long",
    }).format(d);

    const datePart = new Intl.DateTimeFormat("cs-CZ", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
    }).format(d);

    const timePart = d.toLocaleTimeString("cs-CZ", {
        hour: "2-digit",
        minute: "2-digit",
    });

    return {
        day: dayName.charAt(0).toUpperCase() + dayName.slice(1),
        dateTime: `${datePart} ${"  "} ${timePart}`,
    };
};

const MatchCard = ({ match, onClick, disabledTooltip, condensed = false }) => {
    // üîπ v≈ædy pracujme s jednou promƒõnnou
    const playerMatchStatus = match.playerMatchStatus ?? "NO_RESPONSE";

    const statusText = condensed
        ? statusTextPastMap[playerMatchStatus] ?? playerMatchStatus
        : statusTextUpcomingMap[playerMatchStatus] ?? playerMatchStatus;

    const statusClass = statusClassMap[playerMatchStatus] ?? "";
    const StatusIcon = statusIconMap[playerMatchStatus] || null;

    const hasDisabledTooltip = !!disabledTooltip;
    const isRegistered = playerMatchStatus === "REGISTERED";

    const isDisabledByTooltip = hasDisabledTooltip && !isRegistered;
    const isClickable = !!onClick && !isDisabledByTooltip;

    const formatted = formatDateTime(match.dateTime);

    // pro BEM modifier ‚Äì REGISTERED -> "registered", NO_RESPONSE -> "no_response"
    const statusModifier = playerMatchStatus.toLowerCase();

    const handleClick = () => {
        if (isClickable && onClick) {
            onClick();
        }
    };

    return (
        <div
            className={`match-card ${statusClass} ${isClickable ? "clickable" : ""
                } ${isDisabledByTooltip ? "match-card--disabled" : ""}`}
            role={isClickable ? "button" : undefined}
            tabIndex={isClickable ? 0 : -1}
            onClick={isClickable ? handleClick : undefined}
            onKeyDown={
                isClickable
                    ? (e) => e.key === "Enter" && handleClick()
                    : undefined
            }
        >
            <div className="card-body">
                {formatted && (
                    <>
                        <h4 className="card-title text-muted text-center mb-3 match-day">
                            {formatted.day} {" - "} {match.matchNumber}
                        </h4>

                        <h5 className="text-center mb-2 match-date">
                            {formatted.dateTime}
                        </h5>
                    </>
                )}

                <p className="card-text text-center mb-3">
                    <strong>{match.location}</strong>
                </p>

                {!condensed && match.description && (
                    <p className="card-text mb-1">
                        Popis: <strong>{match.description}</strong>
                    </p>
                )}

                <p className="card-text text-center mb-3">
                    <UserIcon className="player-icon" />
                    <strong>
                        {match.inGamePlayers} / {match.maxPlayers}
                    </strong>
                </p>

                {!condensed && (
                    <p className="card-text text-center mb-1 mt-2">
                        <MoneyIcon className="money-icon" />
                        <strong>
                            {match.pricePerRegisteredPlayer.toFixed(0)} Kƒç /{" "}
                            <UserIcon className="player-price-icon" /> Kƒç
                        </strong>
                    </p>
                )}

                {/* üîπ Stav hr√°ƒçe v z√°pase ‚Äì ikona + text */}
                <div className="text-center mt-3">
                    <span
                        className={`player-match-status player-match-status--${statusModifier}`}
                    >
                        {StatusIcon && (
                            <StatusIcon className="player-match-status-icon" />
                        )}
                        <strong className="player-match-status-text">
                            {statusText}
                        </strong>
                    </span>
                </div>
            </div>

            {isDisabledByTooltip && (
                <div className="match-card-tooltip">
                    {disabledTooltip}
                </div>
            )}
        </div>
    );
};

export default MatchCard;

===== FILE: \MatchDetail.jsx =====

// src/components/MatchDetail.jsx
import MatchHeader from "./MatchHeader";
import PlayerMatchStatus from "../players/PlayerMatchStatus";
import MatchActions from "./MatchActions";
import MatchInfo from "./MatchInfo";

const isMatchUpcoming = (match) => {
    if (!match || !match.dateTime) {
        // rad≈°i tlaƒç√≠tka zobrazit, ne≈æ je v≈ædy schovat
        return true;
    }

    const raw = match.dateTime;
    let matchDate;

    if (raw instanceof Date) {
        matchDate = raw;
    } else if (typeof raw === "string") {
        // backend pos√≠l√° "2026-01-23 18:45:00"
        // ‚Üí udƒõl√°me z toho "2026-01-23T18:45:00"
        const normalized = raw.includes("T") ? raw : raw.replace(" ", "T");
        matchDate = new Date(normalized);
    } else {
        // nezn√°m√Ω form√°t ‚Äì rad≈°i povolit tlaƒç√≠tka
        return true;
    }

    if (Number.isNaN(matchDate.getTime())) {
        // ≈°patn√© datum ‚Äì rad≈°i povolit tlaƒç√≠tka
        return true;
    }

    const now = new Date();
    return matchDate > now;
};

const MatchDetail = ({
    match,
    playerMatchStatus,
    matchStatus,
    loading,
    error,
    actionError,
    onRegister,
    onUnregister,
    onExcuse,
    saving,
    isPast,
}) => {
    if (loading) {
        return (
            <div className="container mt-4 text-center">
                <p>Naƒç√≠t√°m detail z√°pasu‚Ä¶</p>
            </div>
        );
    }

    if (error) {
        return (
            <div className="container mt-4 text-center">
                <p className="text-danger mb-3">{error}</p>
            </div>
        );
    }

    if (!match) {
        return (
            <div className="container mt-4 text-center">
                <p>Detail z√°pasu nebyl nalezen.</p>
            </div>
        );
    }
    const isUpcoming = isMatchUpcoming(match);

    return (
        <div className="container mt-3">
            <MatchHeader match={match} />

            <PlayerMatchStatus playerMatchStatus={match.playerMatchStatus}
                variant={isPast ? "past" : "upcoming"} />

            {actionError && (
                <p className="text-danger text-center mb-2">{actionError}</p>
            )}

            {!isPast && (
                <MatchActions
                    playerMatchStatus={playerMatchStatus}
                    onRegister={onRegister}
                    onUnregister={onUnregister}
                    onExcuse={onExcuse}
                    disabled={saving}
                />
            )}

            <MatchInfo match={match} />
        </div>
    );
};

export default MatchDetail;

===== FILE: \MatchHeader.jsx =====



const formatDateTime = (dateTime) => {
    if (!dateTime) return null;

    const iso = dateTime.replace(" ", "T");
    const d = new Date(iso);

    const dayName = new Intl.DateTimeFormat("cs-CZ", {
        weekday: "long",
    }).format(d);

    const datePart = new Intl.DateTimeFormat("cs-CZ", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
    }).format(d);

    const timePart = d.toLocaleTimeString("cs-CZ", {
        hour: "2-digit",
        minute: "2-digit",
    });

    return {
        day: dayName.charAt(0).toUpperCase() + dayName.slice(1),
        dateTime: `${datePart} ${"  "} ${timePart}`,
    };
};


const MatchHeader = ({ match }) => {
    const formatted = formatDateTime(match.dateTime);
    return (
        <div className="mb-3 text-center">
        { formatted && (
            <>
                <h4 className="card-title text-muted text-center mb-1 match-day">
                        {formatted.day} {" - "} {match.matchNumber}
                </h4>

                <h5 className="text-center mb-2 match-date">
                    {formatted.dateTime}
                </h5>
            </>
        )}
        
            <p className="mb-1">
                <strong>M√≠sto:</strong> {match.location}
            </p>
            
        </div>
    );
};

export default MatchHeader;

===== FILE: \MatchInfo.jsx =====

// src/components/MatchInfo.jsx

const MatchInfo = ({ match }) => {
    return (
        <div className="card">
            <div className="card-body">
                {match.description && (
                    <p className="card-text mb-2">
                        <strong>Popis: </strong>
                        {match.description}
                    </p>
                )}

                <p className="card-text mb-2">
                    <strong>Hr√°ƒçi: </strong>
                    {match.inGamePlayers} / {match.maxPlayers}
                </p>

                {match.price != null && (
                    <p className="card-text mb-2">
                        <strong>Cena z√°pasu: </strong>
                        {match.price} Kƒç
                    </p>
                )}

                {match.pricePerRegisteredPlayer != null && (
                    <p className="card-text mb-2">
                        <strong>Cena / hr√°ƒç: </strong>
                        {match.pricePerRegisteredPlayer.toFixed(0)} Kƒç
                    </p>
                )}

                
            </div>
        </div>
    );
};

export default MatchInfo;

===== FILE: \MatchOverview.jsx =====

import React from "react";
import { Link } from "react-router-dom";
import { format } from 'date-fns';


const MatchOverview = ({ match }) => {
    if (!match) return null;

    const formattedDateTime = format(match.dateTime, 'dd.MM.yyyy HH:mm');

    return (
        <section className="mb-3">
            <div className="card h-100">
                <div className="card-body">
                    <h5 className="card-title">
                        Hokej #{match.id} ‚Äì {match.location}
                    </h5>

                    <h6 className="card-subtitle mb-2 text-muted">
                        {formattedDateTime.toLocaleString()}

                    </h6>

                    {match.description && (
                        <p className="card-text">{match.description}</p>
                    )}

                    <p className="card-text">
                        <strong>Maxim√°l hr√°ƒçi:</strong> {match.maxPlayers}
                    </p>

                    <p className="card-text">
                        <strong>Cena:</strong> {match.price} Kƒç
                    </p>
                    <p className="card-text">
                        <strong>Cena za hr√°ƒçe:</strong> {match.pricePerRegisterdPlayer} Kƒç
                    </p>


                    <Link
                        to={`/match/${match.id}`}
                        className="btn btn-primary mt-2"
                    >
                        Detail ƒçehokoliv
                    </Link>
                </div>
            </div>
        </section>
    );
};


export default MatchOverview;

===== FILE: \PastMatches.jsx =====

// src/components/PastMatches.jsx
import { useMyPassedMatches } from "../../hooks/useMyPassedMatches";
import { useCurrentPlayer } from "../../hooks/useCurrentPlayer";
import MatchCard from "./MatchCard";
import { useNavigate } from "react-router-dom";

import "./PastMatches.css";

const PastMatches = () => {
    const { matches, loading, error } = useMyPassedMatches();
    const { currentPlayer } = useCurrentPlayer();
    const navigate = useNavigate();

    if (loading) {
        return <p>Naƒç√≠t√°m uplynul√© z√°pasy‚Ä¶</p>;
    }

    if (error) {
        return (
            <div className="container mt-4 text-center">
                <p className="mb-3 text-danger">{error}</p>
                <button
                    className="btn btn-primary"
                    onClick={() => navigate("/players")}
                >
                    Vybrat aktu√°ln√≠ho hr√°ƒçe
                </button>
            </div>
        );
    }

    if (!currentPlayer) {
        return (
            <div className="container mt-4 text-center">
                <p className="mb-3">
                    Nem√°te vybran√©ho aktu√°ln√≠ho hr√°ƒçe.
                    <br />
                    Pros√≠m vyberte si hr√°ƒçe, pro kter√©ho chcete zobrazit
                    uplynul√© z√°pasy.
                </p>
                <button
                    className="btn btn-primary"
                    onClick={() => navigate("/players")}
                >
                    Vybrat hr√°ƒçe
                </button>
            </div>
        );
    }

    if (matches.length === 0) {
        return (
            <div className="container mt-3">
                <h3 className="mb-3 text-center">
                    Uplynul√© z√°pasy pro {currentPlayer.fullName}
                </h3>
                <p className="text-center">
                    Zat√≠m nem√°te ≈æ√°dn√© uplynul√© z√°pasy.
                </p>
            </div>
        );
    }

    return (
        <div className="container mt-3">
            <h4 className="mb-3 text-center">
                Uplynul√© z√°pasy:
            </h4>

            <div className="past-match-list">
                {[...matches]
                    .sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime))
                    .map((m) => (
                        <div className="past-match-item" key={m.id}>
                            <MatchCard
                                match={m}
                                onClick={() =>
                                    navigate(`/matches/${m.id}`, {
                                        state: { isPast: true },
                                    })
                                }
                                disabledTooltip="Nebyl jsi, nem√°≈° opr√°vnƒõn√≠"
                                condensed
                            />
                        </div>
                    ))}
            </div>
        </div>
    );
};

export default PastMatches;

===== FILE: \UpcomingMatches.jsx =====

// src/components/UpcomingMatches.jsx (p≈Øvodnƒõ Match.jsx)
import { useMyUpcomingMatches } from "../../hooks/useMyUpcomingMatches";
import { useCurrentPlayer } from "../../hooks/useCurrentPlayer";
import MatchCard from "./MatchCard";
import { useNavigate } from "react-router-dom";

import "./UpcomingMatches.css";

const UpcomingMatches = () => {
  const { matches, loading, error } = useMyUpcomingMatches();
  const { currentPlayer } = useCurrentPlayer();
  const navigate = useNavigate();

  if (loading) {
    return <p>Naƒç√≠t√°m nadch√°zej√≠c√≠ z√°pasy‚Ä¶</p>;
  }

  if (error) {
    return (
      <div className="container mt-4 text-center">
        <p className="mb-3 text-danger">{error}</p>
        <button
          className="btn btn-primary"
          onClick={() => navigate("/players")}
        >
          Vybrat aktu√°ln√≠ho hr√°ƒçe
        </button>
      </div>
    );
  }

  if (!currentPlayer) {
    return (
      <div className="container mt-4 text-center">
        <p className="mb-3">
          Nem√°te vybran√©ho aktu√°ln√≠ho hr√°ƒçe.
          <br />
          Pros√≠m vyberte si hr√°ƒçe, pro kter√©ho chcete zobrazit
          nadch√°zej√≠c√≠ z√°pasy.
        </p>
        <button
          className="btn btn-primary"
          onClick={() => navigate("/players")}
        >
          Vybrat hr√°ƒçe
        </button>
      </div>
    );
  }

  if (matches.length === 0) {
    return (
      <div className="container mt-3">
        <h3 className="mb-3 text-center">
          Nadch√°zej√≠c√≠ z√°pasy pro {currentPlayer.fullName}
        </h3>
        <p className="text-center">
          Aktu√°lnƒõ nem√°te ≈æ√°dn√© nadch√°zej√≠c√≠ z√°pasy.
        </p>
      </div>
    );
  }

  return (
    <div className="container mt-3">
      <h4 className="mb-1 text-center player-name">
        {currentPlayer.fullName}
      </h4>
      <h4 className="mb-3 text-center">
        Nadch√°zej√≠c√≠ z√°pasy:
      </h4>

      <div className="match-list">
        {matches.map((m) => (
          <div className="match-item" key={m.id}>
            <MatchCard
              match={m}
              onClick={() =>
                navigate(`/matches/${m.id}`, {
                  state: { isPast: false }, // playerMatchStatus bere≈° z detailu
                })
              }
            />
          </div>
        ))}
      </div>
    </div>
  );
};

export default UpcomingMatches;
