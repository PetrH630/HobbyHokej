

===== FILE: \useAuth.jsx =====

// src/hooks/useAuth.jsx

import { createContext, useContext, useEffect, useState } from "react";
import { fetchCurrentUser, logoutUser } from "../api/authApi";

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);

    const loadUser = async () => {
        setLoading(true);
        try {
            const res = await fetchCurrentUser();
            setUser(res.data);
        } catch {
            setUser(null);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        loadUser();
    }, []);

    const updateUser = async () => {
        await loadUser();
    };

    const logout = async () => {
        try {
            await logoutUser();
        } catch (err) {
            console.error("Logout error:", err);
        } finally {
            setUser(null);
        }
    };

    return (
        <AuthContext.Provider value={{ user, loading, updateUser, logout }}>
            {children}
        </AuthContext.Provider>
    );
};

export const useAuth = () => {
    const context = useContext(AuthContext);
    if (!context) {
        throw new Error("useAuth must be used inside AuthProvider");
    }
    return context;
};

===== FILE: \useCurrentPlayer.jsx =====

// src/hooks/useCurrentPlayer.js
import { createContext, useContext, useEffect, useState } from "react";
import { getCurrentPlayer } from "../api/playerApi";

const CurrentPlayerContext = createContext(null);

export const CurrentPlayerProvider = ({ children }) => {
    const [currentPlayer, setCurrentPlayer] = useState(null);
    const [loading, setLoading] = useState(true);

    const refreshCurrentPlayer = async () => {
        setLoading(true);
        try {
            const res = await getCurrentPlayer();
            setCurrentPlayer(res.data);
        } catch (err) {
            console.error("Nepodařilo se načíst aktuálního hráče", err);
            setCurrentPlayer(null);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        // při prvním načtení chráněné části webu se zkusí načíst aktuální hráč
        refreshCurrentPlayer();
    }, []);

    return (
        <CurrentPlayerContext.Provider
            value={{ currentPlayer, setCurrentPlayer, refreshCurrentPlayer, loading }}
        >
            {children}
        </CurrentPlayerContext.Provider>
    );
};

export const useCurrentPlayer = () => {
    const ctx = useContext(CurrentPlayerContext);
    if (!ctx) {
        throw new Error("useCurrentPlayer musí být použit uvnitř CurrentPlayerProvider");
    }
    return ctx;
};

===== FILE: \useMatchDetail.jsx =====

// src/hooks/useMatchDetail.js
import { useEffect, useState, useCallback } from "react";
import { getMatchDetail } from "../api/matchApi";

export const useMatchDetail = (matchId) => {
    const [match, setMatch] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    const reload = useCallback(async () => {
        if (!matchId) return;
        try {
            setLoading(true);
            setError(null);
            const data = await getMatchDetail(matchId);
            setMatch(data);
        } catch (err) {
            console.error(err);
            setError(
                err?.response?.data?.message || "Nepodařilo se načíst detail zápasu."
            );
        } finally {
            setLoading(false);
        }
    }, [matchId]);

    useEffect(() => {
        reload();
    }, [reload]);

    return { match, loading, error, reload };
};

===== FILE: \useMatches.jsx =====

//custom hook pro načtení zápasů
//Výhoda: UI komponenta jen vypisuje, hook řeší data fetching.

import { useState, useEffect } from "react";
import api from "../api/axios";

export const useMatches = () => {
    const [matches, setMatches] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        api.get("/matches/me/upcoming-overview")
            .then(res => setMatches(res.data))
            .catch(console.error)
            .finally(() => setLoading(false));
    }, []);

    return { matches, loading };
};

===== FILE: \useMyPassedMatches.jsx =====

// src/hooks/useMyPassedMatches.js
import { useEffect, useState } from "react";
import { getMyPassedMatchesOverview } from "../api/matchApi";

export const useMyPassedMatches = () => {
    const [matches, setMatches] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        let isMounted = true;

        const load = async () => {
            try {
                const data = await getMyPassedMatchesOverview();
                if (isMounted) {
                    setMatches(data);
                }
            } catch (err) {
                if (!isMounted) return;

                const status = err?.response?.status;
                const msg = err?.response?.data?.message;

                if (status === 400 || status === 404) {
                    setError(
                        msg ||
                        "Nejprve si musíte vybrat aktuálního hráče."
                    );
                } else {
                    setError(
                        msg ||
                        "Nepodařilo se načíst uplynulé zápasy."
                    );
                }
            } finally {
                if (isMounted) {
                    setLoading(false);
                }
            }
        };

        load();

        return () => {
            isMounted = false;
        };
    }, []);

    return { matches, loading, error };
};

===== FILE: \useMyUpcomingMatches.jsx =====

// src/hooks/useMyUpcomingMatches.js
import { useEffect, useState } from "react";
import { getMyUpcomingMatchesOverview } from "../api/matchApi";

export const useMyUpcomingMatches = () => {
    const [matches, setMatches] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        let isMounted = true;

        const load = async () => {
            try {
                const data = await getMyUpcomingMatchesOverview();
                if (isMounted) {
                    setMatches(data);
                }
            } catch (err) {
                if (!isMounted) return;

                const status = err?.response?.status;
                const msg = err?.response?.data?.message;

                // typicky když není nastaven currentPlayer → 400/404
                if (status === 400 || status === 404) {
                    setError(
                        msg ||
                        "Nejprve si musíte vybrat aktuálního hráče."
                    );
                } else {
                    setError(
                        msg || "Nepodařilo se načíst nadcházející zápasy."
                    );
                }
            } finally {
                if (isMounted) {
                    setLoading(false);
                }
            }
        };

        load();

        return () => {
            isMounted = false;
        };
    }, []);

    return { matches, loading, error };
};

===== FILE: \usePlayers.jsx =====

//logika oddělena od komponenty UI.
import { useState, useEffect } from "react";
import { getMyPlayers } from "../api/playerApi";

export const usePlayers = () => {
    const [players, setPlayers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        setError(null);
        setLoading(true);

        getMyPlayers()
            .then(res => setPlayers(res.data))
            .catch(err => {
                const msg =
                    err?.response?.data?.message ||
                    err.message ||
                    "Nepodařilo se načíst hráče";
                setError(msg);
            })
            .finally(() => setLoading(false));
    }, []);

    return { players, loading, error };
};
